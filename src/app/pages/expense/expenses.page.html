<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>{{ pageTitle }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" [scrollEvents]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title>{{ pageTitle }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <div id="container ion-margin">
    <div class="ion-margin options-container ">
      <ion-button (click)="analyzeExpense()" color="success" class="ion-float-right">
        <ion-icon class="mr-10" name="analytics-outline"></ion-icon>Analyze Expenses</ion-button>
    </div>
    <div class="card ion-margin ion-padding ">
      <h1 class="mt-0 h2">Add Expense</h1>
      <div class="form-container">
        <form [formGroup]="expenseForm" (ngSubmit)="addExpense()" novalidate>
          <div class="input-item">
            <ion-item fill="outline">
              <ion-label position="floating">Date</ion-label>
              <ion-input formControlName="date" type="date"></ion-input>
            </ion-item>
          </div>
          <div class="input-item">
            <ion-item fill="outline">
              <ion-label position="floating">Amount</ion-label>
              <ion-input formControlName="amount" type="number" clearOnEdit="true"></ion-input>
            </ion-item>
          </div>
          <div class="input-item">
            <ion-item fill="outline">
              <ion-label position="floating">Description</ion-label>
              <ion-textarea formControlName="description" type="text" autoGrow="true"
                placeholder="Description about item purchased, location etc." clear-input>
              </ion-textarea>
            </ion-item>
          </div>
          <div class="input-item">
            <ion-item fill="outline">
              <ion-label position="floating">Type</ion-label>
              <ion-select formControlName="type" interface="popover" placeholder="Category of Expense">
                <ion-select-option *ngFor="let type of expenseTypes"
                  [value]="type.value">{{type.title}}</ion-select-option>
              </ion-select>
            </ion-item>
          </div>
          <div class="input-item">
            <ion-item fill="outline">
              <ion-label position="floating">Spent On</ion-label>
              <ion-select formControlName="spendedOn" interface="popover" placeholder="On whom it is Spent">
                <ion-select-option *ngFor="let item of spentOn" [value]="item.value">{{item.title}}</ion-select-option>
              </ion-select>
            </ion-item>
          </div>

          <div class="input-item">
            <ion-button color="primary" type="submit" size="medium" [disabled]="expenseForm.invalid">Submit</ion-button>
            <ion-button color="primary" type="reset" size="medium">Reset</ion-button>
          </div>

        </form>
      </div>
    </div>

    <div class="expense-data card ion-margin ion-padding">
      <div class="table-title">
        <h2 class="mt-0 h2" *ngIf="expensesCount == 0">No Expenses found</h2>
        <h2 class="h2" *ngIf="expensesCount !== 0">My Expenses</h2>
      </div>
      <div class="filters">
        <form action="" #filterForm="ngForm">
          <div class="input-item">
            <ion-item fill="outline">
              <ion-label position="floating">Filter By</ion-label>
              <ion-select [(ngModel)]="filterType" name="filterType" interface="popover" placeholder="Filter By"
                (ionChange)="filterBy()">
                <ion-select-option value="duration">Duration</ion-select-option>
                <ion-select-option value="spentOn">Spent On</ion-select-option>
                <ion-select-option value="type">Type</ion-select-option>
              </ion-select>
            </ion-item>
          </div>

          <div class="input-item">
            <ion-item fill="outline">
              <ion-label position="floating">Parameter</ion-label>
              <ion-select interface="popover" [(ngModel)]="filterParams" name="filterParams" placeholder="parameter"
                (ionChange)="filter()">
                <ng-container *ngIf="filterType == 'duration'">
                  <ion-select-option *ngFor="let item of durationFilter" [value]="item.value">{{ item.title
                    }}</ion-select-option>
                </ng-container>
                <ng-container *ngIf="filterType == 'spentOn'">
                  <ion-select-option *ngFor="let item of spentOn" [value]="item.value">{{ item.title
                    }}</ion-select-option>
                </ng-container>
                <ng-container *ngIf="filterType == 'type'">
                  <ion-select-option *ngFor="let item of expenseTypes"
                    [value]="item.value">{{item.title}}</ion-select-option>
                </ng-container>
              </ion-select>
            </ion-item>
          </div>
          <div class="input-item">
            <ion-item fill="outline" [disabled]="filterType =='duration'">
              <ion-label position="floating">Duration</ion-label>
              <ion-select [(ngModel)]="filterDuration" name="filterDuration" interface="popover" placeholder="Filter By"
                (ionChange)="filter()">
                <ion-select-option *ngFor="let item of durationFilter" [value]="item.value">{{ item.title
                  }}</ion-select-option>
              </ion-select>
            </ion-item>
          </div>
          <p class="ion-text-bold"> {{expenseMessage}} {{expenseCurrency}} {{totalExpense}}</p>
        </form>

        <!-- <ion-button *ngIf="expenseSize == 'week'" color="primary" (click)="getAllExpenses()" size="medium">All
          Expenses</ion-button>
        <ion-button *ngIf="expenseSize == 'all'" color="primary" (click)="getExpenses()" size="medium">Latest
          Only</ion-button> -->

      </div>
      <div class="data-grid" *ngIf="expensesCount > 0">
        <ion-grid class="border-6">
          <ion-row>
            <!-- <ion-col size="1">S.No</ion-col> -->
            <ion-col size="2">Date</ion-col>
            <ion-col size="1">Cost</ion-col>
            <ion-col size="2">Type</ion-col>
            <ion-col size="3">Description</ion-col>
            <ion-col size="2">Spent On</ion-col>
            <ion-col size="2">Action</ion-col>
          </ion-row>
          <ion-row *ngFor="let expense of Expenses; index as i">
            <!-- <ion-col size="1">{{ i + 1 }}</ion-col> -->
            <ion-col size="2">{{ expense?.date }}</ion-col>
            <ion-col size="1">â‚¹{{ expense?.amount }}</ion-col>
            <ion-col size="2">{{ expense?.type | titlecase }}</ion-col>
            <ion-col size="3" class="ion-text-wrap ion-text-left"><pre>{{ expense?.description}}</pre></ion-col>
            <ion-col size="2">{{ expense?.spendedOn | titlecase}}</ion-col>
            <ion-col size="2">
              <!-- <ion-button class="action-button" color="secondary">
                <ion-icon color="light" [ios]="'pencil-outline'" [md]="'pencil-sharp'"></ion-icon>
              </ion-button> -->
              <ion-button class="action-button" color="danger" (click)="deleteExpense(expense.idField)">
                <ion-icon color="light" [ios]="'trash-outline'" [md]="'trash-sharp'"></ion-icon>
              </ion-button>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>

      <ion-note class="mt-15px" color="tertiary" *ngIf="expensesCount !== 0">* Edit feature coming soon.</ion-note>
    </div>

    <div class="card ion-margin ion-padding disclaimer">
      <h3 class="mt-0 h2" *ngIf="!budgetExists">Record and Analyze Expense</h3>
      <h3 class="mt-0 h2" *ngIf="budgetExists">My budget list</h3>
      <p color="tertiary" class="h5 ml-10 ion-text-justify">* Note : To use upcoming Analyze feature it is required to
        provide your income / budget ( planned / alloted amount to be spent ) for the specific month</p>
      <form class="form-container budget-container" [formGroup]="budgetForm" novalidate>
        <div class="input-item">
          <ion-item fill="outline">
            <ion-label position="floating">Amount</ion-label>
            <ion-input formControlName="amount" type="number" clearOnEdit="true"></ion-input>
          </ion-item>
        </div>
        <div class="input-item">
          <ion-item fill="outline">
            <ion-label position="floating">Budget for</ion-label>
            <ion-input formControlName="month" type="month"></ion-input>
          </ion-item>
        </div>
        <div class="input-item">
          <ion-button color="primary" type="submit" size="medium" *ngIf="!budgetExists" (click)="addBudget()">Add Budget</ion-button>
          <ion-button color="primary" type="submit" size="medium" *ngIf="budgetExists" (click)="updateBudget()">Update</ion-button>
          <ion-button color="success" *ngIf="!budgetExists" size="medium" (click)="getBudget()">Get My Budget</ion-button>
          <ion-button color="tertiary" *ngIf="budgetExists" size="medium" (click)="budgetExists=false">Go to Add Budget</ion-button>
        </div>
      </form>
      <div *ngIf="budgetExists">
        <span class="h2 ml-10">Existing Budget</span>
        <ion-list lines="none">
          <ion-item>
            <ion-label class="ion-text-bold">Month : Amount</ion-label>
          </ion-item>
          <ion-item *ngFor="let item of Budget">
            <ion-label class="ion-text-bold">{{ item.month | date:'MMM y' }}</ion-label>
            <ion-label> : {{expenseCurrency}} {{item.amount}}</ion-label>
          </ion-item>
        </ion-list>
      </div>
    </div>
  </div>
</ion-content>
