<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>{{ pageTitle }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" [scrollEvents]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title>{{ pageTitle }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <div id="container ion-margin">
    <!-- <div class="ion-margin options-container">
      <ion-item>
        <ion-textarea [(ngModel)]="recognizedText" placeholder="Recognized speech will appear here..."></ion-textarea>
      </ion-item>
      <ion-button (click)="transformExpenseInput()">Add Expense</ion-button>
      <div *ngIf="transformedData">
        <h3>Extracted Information:</h3>
        <pre>{{ transformedData | json }}</pre>
      </div>
    </div> -->
    <div class="ion-margin options-container">
      <!-- Added filter icon button -->

      <ion-button id="zero-expense-alert" color="success" class="ion-float-right">
        <ion-icon class="mr-10" name="cash-outline"></ion-icon>
        0 Expense day
      </ion-button>
      <ion-button routerLink="./shopping-list" color="primary" class="ion-float-right">
        <ion-icon class="mr-10" name="cart-outline"></ion-icon>
        Shopping List
      </ion-button>
      <ion-alert
        trigger="zero-expense-alert"
        header="Add item details"
        [buttons]="zeroExpenseButtons"
        [inputs]="zeroExpenseInputs"
      ></ion-alert>
    </div>
    <div class="card ion-margin ion-padding">
      <h1 class="mt-0 h2">{{editMode?"Update":"Add"}} Expense</h1>
      <div class="form-container">
        <form [formGroup]="expenseForm" (ngSubmit)="addExpense()" novalidate>
          <ion-list class="form-ion-list">
            <ion-item lines="none">
              <ion-input
                label="Date"
                [value]="dateToday | date:'yyyy-MM-dd'"
                locale="en-IN"
                label-placement="floating"
                formControlName="date"
                type="date"
              ></ion-input>
            </ion-item>
            <ion-item lines="none">
              <ion-input
                label="Amount"
                label-placement="floating"
                formControlName="amount"
                type="number"
                clearOnEdit="true"
              ></ion-input>
            </ion-item>
            <ion-item lines="none">
              <ion-textarea
                label="Description"
                label-placement="floating"
                formControlName="description"
                type="text"
                autoGrow="true"
                placeholder="Description about item purchased, location etc."
                clear-input
              ></ion-textarea>
            </ion-item>
            <ion-item lines="none">
              <ion-select
                label="Type"
                label-placement="floating"
                formControlName="type"
                interface="popover"
                placeholder="Category of Expense"
              >
                <ion-select-option *ngFor="let type of expenseTypes" [value]="type.value">
                  {{type.title}}
                </ion-select-option>
              </ion-select>
            </ion-item>
            <ion-item lines="none">
              <div>
                <p class="spent-on">Spent on</p>
                <ion-radio-group
                  formControlName="spendedOn"
                  label="Spent On"
                  label-placement="floating"
                  class="inline-radio"
                >
                  <ion-radio *ngFor="let item of spentOn" [value]="item.value" labelPlacement="end">
                    {{item.title}}
                  </ion-radio>
                </ion-radio-group>
              </div>
            </ion-item>
            <ion-item lines="none">
              <ion-checkbox
                formControlName="reimburseable"
                [checked]="expenseForm.get('reimburseable').value"
                (ionChange)="expenseForm.get('reimburseable').setValue($event.detail.checked)"
                label="Reimbursable"
                label-placement="floating"
              >
                Reimbursable
              </ion-checkbox>
            </ion-item>

            <div class="button-container">
              <div class="button-flex" *ngIf="!editMode">
                <ion-button color="warning" type="reset" size="medium">Reset</ion-button>
                <ion-button color="success" type="submit" size="medium" [disabled]="expenseForm.invalid">
                  Submit
                </ion-button>
              </div>
              <div class="button-flex" *ngIf="editMode">
                <ion-button
                  color="warning"
                  (click)="updateExpense()"
                  size="medium"
                  [disabled]="expenseForm.untouched || updateSubmitted"
                >
                  Update
                </ion-button>
                <ion-button color="primary" type="reset" size="medium" (click)="cancelUpdate()">Cancel</ion-button>
              </div>
            </div>
          </ion-list>
        </form>
      </div>
    </div>

    <ng-container *ngIf="!editMode">
      <div class="card ion-margin ion-padding">
        <h3 class="h2 mt-0">Get all for a day</h3>
        <div class="mt-15px">
          <form #getExpenseOf="ngForm" class="form-container" (ngSubmit)="getAllExpenseOf()">
            <ion-list class="form-ion-list">
              <ion-item lines="none">
                <ion-input
                  label="Date"
                  label-placement="floating"
                  type="date"
                  name="expenseOf"
                  [(ngModel)]="expenseOf"
                ></ion-input>
              </ion-item>
              <div class="button-container">
                <div class="button-flex">
                  <ion-button color="warning" type="reset" size="medium">Reset</ion-button>
                  <ion-button
                    [disabled]="getExpenseOf.untouched && expenseOf === ''"
                    color="success"
                    type="submit"
                    size="medium"
                  >
                    Submit
                  </ion-button>
                </div>
              </div>
            </ion-list>
          </form>
        </div>
        <div class="expenses" *ngIf="expenseByDate">
          <h4>Expense logged for {{expenseOf}}</h4>
          <div class="form-container data-grid">
            <app-expense-card
              class="expense-data-card"
              *ngFor="let item of expenseByDate"
              [expenseItem]="item"
              (editClicked)="editExpense($event)"
              (deleteClicked)="deleteExpense($event.idField)"
            ></app-expense-card>
          </div>
        </div>
      </div>

      <div class="expense-data card ion-margin ion-padding">
        <div class="table-title">
          <h2 class="mt-0 h2" *ngIf="expensesCount === 0">No Expenses found</h2>
          <h2 class="h2" *ngIf="expensesCount > 0">My Expenses</h2>

          <div class="action-bar" *ngIf="expensesCount > 0">
            <ion-button size="small" color="medium" (click)="openFilterModal()">
              <ion-icon slot="icon-only" name="filter"></ion-icon>
              <span>Filter</span>
            </ion-button>
            <ion-button size="small" color="tertiary" (click)="exportData()">
              <ion-icon slot="icon-only" name="cloud-download-outline"></ion-icon>
              <span>Export</span>
            </ion-button>
            <ion-button size="small" (click)="analyzeExpense()" color="success">
              <ion-icon slot="icon-only" name="analytics-outline"></ion-icon>
              <span>Analyze</span>
            </ion-button>
          </div>
        </div>

        <div class="">
          <p class="ion-text-bold">{{ expenseMessage }} {{ expenseCurrency }} {{ totalExpense }}</p>
        </div>
        <ng-container *ngIf="expensesCount > 0">
          <div class="form-container data-grid">
            <app-expense-card
              class="expense-data-card"
              *ngFor="let item of Expenses"
              [expenseItem]="item"
              (editClicked)="editExpense($event)"
              (deleteClicked)="deleteExpense($event.idField)"
            ></app-expense-card>
          </div>
          <div class="mt-15px form-container"></div>
        </ng-container>
      </div>

      <div class="card ion-margin ion-padding disclaimer">
        <h3 class="mt-0 h3 mb-5">{{ budgetExists ? 'My budget' : 'Add Budget' }}</h3>
        <ion-note *ngIf="!budgetExists" color="secondary" class="ion-margin ion-text-justify">{{budgetNote}}</ion-note>

        <form class="form-container budget-container" [formGroup]="budgetForm" novalidate>
          <ion-list class="form-ion-list" lines="none">
            <ion-item lines="none">
              <ion-input
                label="Amount"
                label-placement="floating"
                formControlName="amount"
                type="number"
                clearOnEdit="true"
              ></ion-input>
            </ion-item>

            <ion-item lines="none">
              <ion-input label="Budget for" label-placement="floating" formControlName="month" type="month"></ion-input>
            </ion-item>
          </ion-list>
          <div class="button-container">
            <div class="button-flex">
              <ion-button color="tertiary" *ngIf="!budgetExists" size="medium" (click)="getBudget()">
                My Budget
              </ion-button>
              <ion-button
                color="success"
                type="submit"
                size="medium"
                *ngIf="!budgetExists"
                [disabled]="budgetForm.invalid"
                (click)="addBudget()"
              >
                <ion-icon name="add-outline" slot="start"></ion-icon>
                Budget
              </ion-button>
              <ion-button color="tertiary" *ngIf="budgetExists" size="medium" (click)="budgetExists=false">
                <ion-icon slot="start" name="arrow-undo-outline"></ion-icon>
                Add Budget
              </ion-button>
              <ion-button
                color="success"
                type="submit"
                size="medium"
                *ngIf="budgetExists"
                [disabled]="budgetForm.invalid"
                (click)="updateBudget()"
              >
                <ion-icon slot="start" name="create-outline"></ion-icon>
                Update
              </ion-button>
            </div>
          </div>
        </form>
        <div *ngIf="budgetExists; else noBudget" class="form-container">
          <span class="h3">Monthly Budget</span>
          <ion-list class="form-ion-list mt-15px" lines="none">
            <ion-item lines="none">
              <ion-label class="ion-text-bold">Month</ion-label>
              <ion-label class="ion-text-bold">Amount</ion-label>
            </ion-item>
            <ion-item lines="none" *ngFor="let item of Budget">
              <ion-label class="ion-text-bold">{{ item.month | date:'MMM y' }}</ion-label>
              <ion-label>{{expenseCurrency}} {{item.amount}}</ion-label>
            </ion-item>
          </ion-list>
        </div>
        <ng-template #noBudget>
          <ion-note color="warning" class="ion-margin ion-text-justify">
            No Budget Found, Fill amount and add budget.
          </ion-note>
        </ng-template>
      </div>
    </ng-container>
  </div>
  <!-- Floating mic button -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="startListening()" *ngIf="!isListening">
      <ion-icon name="mic"></ion-icon>
    </ion-fab-button>

    <ion-fab-button (click)="stopListening()" *ngIf="isListening">
      <ion-icon name="mic-off"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
